<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Private Cards</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css"/>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@24,400,0,0" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <style>
        :root { --bg: #0b0b0b; --accent: #fff; --pill: #1a1a1a; --error: #ff4444; }
        body, html { margin: 0; padding: 0; height: 100%; background: var(--bg); color: #fff; font-family: -apple-system, sans-serif; overflow: hidden; }
        .flex-center { display: flex; align-items: center; justify-content: center; flex-direction: column; height: 100%; }
        .hidden { display: none !important; }

        /* Экраны */
        #auth-screen, #app-screen { width: 100%; height: 100%; position: absolute; }

        /* ПИН-код */
        .pin-dots { display: flex; gap: 15px; margin-bottom: 30px; }
        .dot { width: 15px; height: 15px; border: 2px solid #333; border-radius: 50%; }
        .dot.filled { background: var(--accent); border-color: var(--accent); }
        .keypad { display: grid; grid-template-columns: repeat(3, 70px); gap: 20px; }
        .key { width: 70px; height: 70px; background: #151515; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 24px; cursor: pointer; }

        /* Табы (Пилюли) */
        .nav-bar { position: fixed; bottom: 30px; display: flex; align-items: center; gap: 10px; z-index: 100; }
        .pills { display: flex; background: var(--pill); padding: 5px; border-radius: 30px; }
        .pill { padding: 12px 20px; border-radius: 25px; border: none; background: none; color: #666; font-weight: 600; font-size: 12px; cursor: pointer; }
        .pill.active { background: var(--accent); color: #000; }

        /* Кнопка действия */
        .action-btn { width: 55px; height: 55px; background: var(--accent); color: #000; border-radius: 50%; border: none; display: flex; align-items: center; justify-content: center; cursor: pointer; }

        /* Слайдер */
        .swiper { width: 320px; height: 450px; }
        .swiper-slide { border-radius: 30px; background: #151515; overflow: hidden; border: 1px solid #222; }
        .swiper-slide img { width: 100%; height: 100%; object-fit: cover; }

        /* Загрузка */
        .upload-zone { text-align: center; padding: 20px; border: 2px dashed #333; border-radius: 20px; width: 280px; }
    </style>
</head>
<body>

    <div id="auth-screen" class="flex-center">
        <div class="pin-dots" id="pin-dots">
            <div class="dot"></div><div class="dot"></div><div class="dot"></div><div class="dot"></div>
        </div>
        <div class="keypad" id="keypad">
            <div class="key" onclick="press(1)">1</div><div class="key" onclick="press(2)">2</div><div class="key" onclick="press(3)">3</div>
            <div class="key" onclick="press(4)">4</div><div class="key" onclick="press(5)">5</div><div class="key" onclick="press(6)">6</div>
            <div class="key" onclick="press(7)">7</div><div class="key" onclick="press(8)">8</div><div class="key" onclick="press(9)">9</div>
            <div></div><div class="key" onclick="press(0)">0</div><div class="key" onclick="press('C')">×</div>
        </div>
    </div>

    <div id="app-screen" class="flex-center hidden">
        
        <div id="tab-main" class="tab-content">
            <div class="swiper"><div class="swiper-wrapper" id="main-wrapper"></div></div>
        </div>

        <div id="tab-tags" class="tab-content hidden flex-center">
            <div id="tag-selector" class="pills" style="margin-bottom: 20px;"></div>
            <div class="swiper"><div class="swiper-wrapper" id="tag-wrapper"></div></div>
        </div>

        <div id="tab-upload" class="tab-content hidden flex-center">
            <div class="upload-zone" onclick="document.getElementById('fileInput').click()">
                <span class="material-symbols-rounded" style="font-size: 48px;">cloud_upload</span>
                <p>Выбрать фото</p>
                <input type="file" id="fileInput" class="hidden" onchange="handleFile(this)">
            </div>
            <div id="upload-preview" class="hidden" style="margin-top:20px; text-align:center;">
                <img id="prev-img" style="width:100px; border-radius:10px;">
                <div id="upload-tags" class="pills" style="margin-top:10px"></div>
            </div>
        </div>

        <div class="nav-bar">
            <button class="action-btn" id="main-action" onclick="handleAction()">
                <span class="material-symbols-rounded" id="action-icon">download</span>
            </button>
            <div class="pills">
                <button class="pill active" onclick="switchTab('main', this)">ГЛАВНАЯ</button>
                <button class="pill" onclick="switchTab('tags', this)">ТЕГИ</button>
                <button class="pill" onclick="switchTab('upload', this)">ЗАГРУЗИТЬ</button>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
    <script>
        const PIN_HASH = "4225466f46976e5877d0c8f7a77eafbf97a92841dedabae705816fa4c76e033f";
        const TYPES = {"funny":"смешные","arguments":"сора"};
        const ALL_FILES = ["IMG_2620.jpeg","IMG_2761.jpeg","IMG_2763.jpeg","IMG_3341.jpeg","IMG_3350.jpeg","IMG_3351.jpeg","IMG_3352.jpeg","IMG_3353.jpeg","IMG_3357.jpeg","IMG_3363.jpeg","IMG_3364.jpeg","en-arguments","en-funny","ru-arguments","ru-funny"];
        const REPO = "USER/REPO"; // ЗАМЕНИТЬ!
        
        let currentPin = "";
        let decryptedImages = {}; // Кэш расшифрованных картинок
        let activeTab = 'main';
        let selectedFile = null;
        let selectedUploadTag = '';

        // --- ПИН КОД ---
        function press(n) {
            if(n === 'C') { currentPin = ""; }
            else if(currentPin.length < 4) { currentPin += n; }
            
            const dots = document.querySelectorAll('.dot');
            dots.forEach((d, i) => d.className = i < currentPin.length ? 'dot filled' : 'dot');

            if(currentPin.length === 4) {
                const hash = CryptoJS.SHA256(currentPin).toString();
                if(hash === PIN_HASH) {
                    document.getElementById('auth-screen').classList.add('hidden');
                    document.getElementById('app-screen').classList.remove('hidden');
                    initApp();
                } else {
                    currentPin = "";
                    alert("Неверный ПИН");
                    dots.forEach(d => d.className = 'dot');
                }
            }
        }

        // --- ИНИЦИАЛИЗАЦИЯ ---
        async function initApp() {
            // Подгружаем все картинки из папки images
            const mainWrapper = document.getElementById('main-wrapper');
            for(let f of ALL_FILES) {
                if(f.includes('.')) {
                    const slide = createSlide(f);
                    mainWrapper.appendChild(slide);
                }
            }
            initSwiper('.swiper');
            
            // Теги для поиска
            const tagCont = document.getElementById('tag-selector');
            Object.entries(TYPES).forEach(([en, ru]) => {
                let b = document.createElement('button');
                b.className = 'pill';
                b.innerText = ru.toUpperCase();
                b.onclick = () => filterByTag(en);
                tagCont.appendChild(b);
            });
        }

        function createSlide(fileName) {
            const div = document.createElement('div');
            div.className = 'swiper-slide';
            const img = document.createElement('img');
            img.dataset.src = `images/${fileName}`;
            img.src = "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7"; // placeholder
            div.appendChild(img);
            decryptImage(img, fileName);
            return div;
        }

        async function decryptImage(imgElement, fileName) {
            const res = await fetch(`images/${fileName}`);
            const encrypted = await res.text();
            try {
                const decrypted = CryptoJS.AES.decrypt(encrypted, currentPin).toString(CryptoJS.enc.Utf8);
                imgElement.src = decrypted;
                decryptedImages[fileName] = decrypted;
            } catch(e) { imgElement.alt = "Ошибка расшифровки"; }
        }

        // --- ТАБЫ ---
        function switchTab(tab, btn) {
            activeTab = tab;
            document.querySelectorAll('.tab-content').forEach(c => c.classList.add('hidden'));
            document.getElementById(`tab-${tab}`).classList.remove('hidden');
            document.querySelectorAll('.pill').forEach(p => p.classList.remove('active'));
            btn.classList.add('active');
            
            const icon = document.getElementById('action-icon');
            icon.innerText = tab === 'upload' ? 'publish' : 'download';
        }

        // --- ЗАГРУЗКА И ШИФРОВАНИЕ ---
        function handleFile(input) {
            const file = input.files[0];
            const reader = new FileReader();
            reader.onload = (e) => {
                selectedFile = e.target.result;
                document.getElementById('prev-img').src = selectedFile;
                document.getElementById('upload-preview').classList.remove('hidden');
                
                const ut = document.getElementById('upload-tags');
                ut.innerHTML = '';
                Object.keys(TYPES).forEach(t => {
                    let b = document.createElement('button');
                    b.className = 'pill'; b.innerText = t;
                    b.onclick = () => {
                        selectedUploadTag = t;
                        document.querySelectorAll('#upload-tags .pill').forEach(p => p.classList.remove('active'));
                        b.classList.add('active');
                    };
                    ut.appendChild(b);
                });
            };
            reader.readAsDataURL(file);
        }

        async function handleAction() {
            if(activeTab === 'upload') {
                if(!selectedFile || !selectedUploadTag) return alert("Выбери фото и тег");
                const encrypted = CryptoJS.AES.encrypt(selectedFile, currentPin).toString();
                const token = prompt("Введите GitHub Token для загрузки:");
                if(!token) return;

                const fileName = `ru_${selectedUploadTag}_${Date.now()}.enc`;
                const url = `https://api.github.com/repos/${REPO}/contents/images/${fileName}`;
                
                await fetch(url, {
                    method: 'PUT',
                    headers: { 'Authorization': `token ${token}` },
                    body: JSON.stringify({
                        message: "Add encrypted photo",
                        content: btoa(encrypted)
                    })
                });
                alert("Загружено! Обновится через минуту.");
            } else {
                // Скачивание
                const activeSlide = document.querySelector(`#tab-${activeTab} .swiper-slide-active img`);
                const link = document.createElement('a');
                link.href = activeSlide.src;
                link.download = "decrypted_image.png";
                link.click();
            }
        }

        function initSwiper(selector) {
            new Swiper(selector, { effect: "cards", grabCursor: true });
        }
    </script>
</body>
</html>
